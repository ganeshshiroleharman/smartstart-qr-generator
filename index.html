<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Z-Wave SmartStart QR Generator</title>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>

body {
    font-family: Arial;
    background: #f4f4f4;
    padding: 20px;
}

.container {
    background: white;
    padding: 20px;
    max-width: 600px;
    border-radius: 8px;
}

input, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    margin-bottom: 15px;
    font-size: 14px;
}

button {
    padding: 10px;
    margin-right: 10px;
    cursor: pointer;
}

.error {
    color: red;
}

.success {
    color: green;
}

canvas {
    margin-top: 20px;
}

.footer {
    margin-top: 20px;
    font-size: 12px;
    color: gray;
}

</style>

</head>

<body>

<div class="container">

<h2>Z-Wave SmartStart QR Generator</h2>

<label>Provisioning String (Factory "90..." OR ZWS2DSK format)</label>

<textarea
    id="qrInput"
    rows="3"
    placeholder="Example:
900111873003646434913609885522405516530556171343867100100179303072022001114000040027700258

OR

ZWS2DSK:64643-49136-09885-52240-55165-30556-17134-38671"
></textarea>

<div id="error" class="error"></div>

<button onclick="generateQR()">Generate QR</button>

<button onclick="downloadQR()">Download QR</button>

<div id="status"></div>

<canvas id="qrCanvas"></canvas>

<div class="footer">
Version: v1.0
</div>

</div>

<script>

const APP_VERSION = "v1.0";

let currentQR = "";

console.log("SmartStart QR Generator Version:", APP_VERSION);


// ===========================
// Validate provisioning string
// ===========================

function validateInput(input)
{

    if (!input)
        return "Input cannot be empty";

    // Factory format
    if (input.startsWith("90"))
    {
        if (!/^[0-9]+$/.test(input))
            return "Factory QR must contain only digits";

        if (input.length < 50)
            return "Factory QR string too short";

        return null;
    }

    // ZWS2DSK format
    if (input.startsWith("ZWS2DSK:"))
    {

        const dsk = input.substring(7);

        const regex = /^(\d{5}-){7}\d{5}$/;

        if (!regex.test(dsk))
            return "Invalid DSK format";

        return null;
    }

    return "Must start with 90 or ZWS2DSK:";
}


// ===========================
// Generate QR
// ===========================

function generateQR()
{

    clearError();

    const input = document.getElementById("qrInput").value.trim();

    const error = validateInput(input);

    if (error)
    {
        showError(error);
        return;
    }

    currentQR = input;

    QRCode.toCanvas(
        document.getElementById("qrCanvas"),
        input,
        { width: 300 }
    );

    document.getElementById("status").innerHTML =
        "<span class='success'>QR generated successfully</span>";

    console.log("Generated QR:", input);
}


// ===========================
// Download QR
// ===========================

function downloadQR()
{

    if (!currentQR)
    {
        alert("Generate QR first");
        return;
    }

    const canvas = document.getElementById("qrCanvas");

    const link = document.createElement("a");

    link.download = "zwave-smartstart-qr-v1.0.png";

    link.href = canvas.toDataURL();

    link.click();
}


// ===========================
// Error handling
// ===========================

function showError(msg)
{
    document.getElementById("error").innerText = msg;
}

function clearError()
{
    document.getElementById("error").innerText = "";
}

</script>

</body>

</html>
